{% extends "./soundcloud.html" %}
{% block headscripts %}
<script type="text/javascript">
	getAverageVolume = function(array) {
		var values = 0;
		var length = array.length;
		for(var i = 0; i < length; i++) {
			values+=array[i];
		}
		var average=values/length;
		return average;
	}
	$(function() {
		var $body = $("#gh-body");
		window.canvas = document.createElement("canvas");

		canvas.width = $body.width();
		canvas.height = 100;

		$body.html(canvas);
		
		window.canvasctx = canvas.getContext("2d");
		window.audioctx = new AudioContext();
		window.scriptprocesor = audioctx.createScriptProcessor(2048,1,1);

		scriptprocesor.connect(audioctx.destination);

		window.analyser = audioctx.createAnalyser();
		analyser.smoothingTimeConstant = 0.3;
		analyser.fftSize = 512;

		window.buffersource = audioctx.createBufferSource();

		buffersource.connect(analyser);
		analyser.connect(scriptprocesor);

		scriptprocesor.onaudioprocess = function () {
			var array = new Uint8Array(analyser.frequencyBinCount);
			analyser.getByteFrequencyData(array);

			canvasctx.clearRect(0,0,canvas.width,canvas.height);
			canvasctx.fillStyle="#444";

			var value;

			for(var i = 0; i < array.length; i++)
			{
				value = array[i];
				canvasctx.fillRect(i*5,canvas.height-value,3,canvas.height);
			}
		};
	});
</script>
{% endblock %}
{% block body %}
{% endblock %}